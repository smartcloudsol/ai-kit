var we=Object.defineProperty;var h=(e,t)=>()=>(e&&(t=e(e=0)),t);var U=(e,t)=>{for(var r in t)we(e,r,{get:t[r],enumerable:!0})};function R(){return globalThis.WpSuite?.plugins?.aiKit}async function H(e=8e3){let t=R();if(t?.status!=="available"){if(t?.status==="error")throw new Error("AiKit failed");await new Promise((r,a)=>{let n=()=>i(r),o=()=>i(()=>a(new Error("AiKit failed"))),i=l=>{window.removeEventListener("wpsuite:ai-kit:ready",n),window.removeEventListener("wpsuite:ai-kit:error",o),u&&clearTimeout(u),l()};window.addEventListener("wpsuite:ai-kit:ready",n,{once:!0}),window.addEventListener("wpsuite:ai-kit:error",o,{once:!0});let u=e?window.setTimeout(()=>i(()=>a(new Error("AiKit timeout"))),e):0})}}async function ve(e=1e4){await H(e);let r=R()?.features?.store;if(!r)throw new Error("AiKit store is not available");return r}var z=h(()=>{"use strict"});import{getConfig as Ae}from"@smart-cloud/wpsuite-core";import{createReduxStore as Ce,dispatch as he,register as Pe,select as ke,subscribe as xe}from"@wordpress/data";import{I18n as V}from"aws-amplify/utils";var W,X,Le,Se,Re,Te,Oe,Be,E,J,Ke,F=h(()=>{"use strict";z();typeof WpSuite<"u"?W=WpSuite.siteSettings:W={};X=e=>{let t=e&&typeof e=="object"?e:{},r={};return typeof t.mode=="string"&&(r.mode=t.mode),typeof t.backendTransport=="string"&&(r.backendTransport=t.backendTransport),typeof t.backendApiName=="string"&&(r.backendApiName=t.backendApiName),typeof t.backendBaseUrl=="string"&&(r.backendBaseUrl=t.backendBaseUrl),typeof t.subscriptionType=="string"&&(r.subscriptionType=t.subscriptionType),r},Le=async()=>{let e=R();if(!e)throw new Error("AI-Kit plugin is not available");let t=null;return e.settings.customTranslationsUrl&&(t=await fetch(e.settings.customTranslationsUrl+(e.settings.customTranslationsUrl.includes("?")?"&":"?")+"t="+W.lastUpdate).then(r=>r.ok?r.text():null).then(r=>r?JSON.parse(r):null).catch(()=>null)),t??null},Se=async()=>{let e=X(await Ae("aiKit")),t=await Le();return{config:e,language:void 0,direction:void 0,customTranslations:t}},Re={setLanguage(e){return!e||e==="system"?V.setLanguage(""):V.setLanguage(e),{type:"SET_LANGUAGE",language:e}},setDirection(e){return{type:"SET_DIRECTION",direction:e}}},Te={getConfig(e){return e.config},getCustomTranslations(e){return e.customTranslations},getLanguage(e){return e.language},getDirection(e){return e.direction},getState(e){return e}},Oe={},Be=e=>he(e),E=e=>ke(e),J=async()=>{let e=await Se(),t=Ce("wpsuite/ai-kit",{reducer(r=e,a){switch(a.type){case"SET_LANGUAGE":return{...r,language:a.language};case"SET_DIRECTION":return{...r,direction:a.direction}}return r},actions:Re,selectors:Te,resolvers:Oe});return Pe(t),t},Ke=(e,t,r)=>{let a;function n(){let i=E(e).getState(),u=t(i);if(u!==a){let l=a;a=u,r(a,l)}}let o=xe(n,e);return n(),o}});var P,N=h(()=>{"use strict";P=class extends Error{constructor(r,a,n){super(r);this.decision=a;this.status=n;this.name="AiBackendError"}}});import{jsx as A,jsxs as Z}from"react/jsx-runtime";var Ft,It,Q=h(()=>{"use strict";Ft=e=>Z("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"48",height:"48",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[A("path",{d:"M19 27H33"}),A("path",{d:"M19 33H33"}),A("path",{d:"M8 21L9.5 24L12.5 25.5L9.5 27L8 30L6.5 27L3.5 25.5L6.5 24Z"}),A("path",{d:"M36 4L38 8L42 10L38 12L36 16L34 12L30 10L34 8Z"}),A("path",{d:"M16 10V40H36V22"}),A("path",{d:"M16 10H22"}),A("path",{d:"M22 10V23H36"}),A("path",{d:"M22 10L36 22"})]}),It=e=>Z("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"48",height:"48",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[A("path",{d:"M42 38L34 30H10C7.79086 30 6 28.2091 6 26V8C6 5.79086 7.79086 4 10 4H38C40.2091 4 42 5.79086 42 8V38Z"}),A("rect",{x:"14",y:"13",width:"6",height:"6",rx:"1"}),A("rect",{x:"28",y:"13",width:"6",height:"6",rx:"1"}),A("path",{d:"M16 24H32"})]})});var ae={};U(ae,{MIN_CHROME_VERSION:()=>te,checkOnDeviceAvailability:()=>ne,decideCapability:()=>M});import{getWpSuite as Ee}from"@smart-cloud/wpsuite-core";async function Y(){let t=await Fe?.plugins?.aiKit?.features.store;return E(t).getConfig()??{}}function ee(e){let t=e.backendApiName?.trim()||void 0,r=e.backendBaseUrl?.trim()||void 0;return{transport:e.backendTransport??(r?"fetch":t?"gatey":void 0),backendApiName:t,backendBaseUrl:r}}function Ie(e){if(e.mode)return e.mode;let{transport:t}=ee(e);return t?"backend-fallback":"local-only"}async function Me(){let e=await Y(),{transport:t,backendApiName:r,backendBaseUrl:a}=ee(e);if(!t)return{available:!1,reason:"No backend configured"};if(t==="fetch")return a?{available:!0,transport:t,baseUrl:a,reason:"Custom fetch backend"}:{available:!1,reason:"backendBaseUrl is missing"};if(!r)return{available:!1,reason:"backendApiName is missing"};let n=globalThis.WpSuite?.plugins?.gatey;return!n?.availability||await n.availability()!=="available"?{available:!1,reason:"Gatey is not available"}:{available:!0,transport:t,apiName:r,reason:"Gatey backend"}}function x(e){return typeof globalThis[e]<"u"}function re(e){if(!e)return;let t=Number.parseInt(String(e).split(".")[0]??"",10);return Number.isFinite(t)?t:void 0}function I(e,t){return e?.find(r=>r.brand===t)?.version}async function De(){let e=navigator?.userAgentData;if(e){try{let r=(await e.getHighEntropyValues?.(["fullVersionList"]))?.fullVersionList;if(Array.isArray(r)&&r.length>0)return r}catch{}if(Array.isArray(e.brands)&&e.brands.length>0)return e.brands}}function Ue(e){let t=e.match(/\b(?:Chrome|Chromium)\/(\d{2,3})\b/i);return t?.[1]?re(t[1]):void 0}function ze(){return!!navigator?.brave}async function We(e){if(typeof navigator>"u")return{allowed:!1,reason:"no-navigator"};if(typeof globalThis.isSecureContext=="boolean"&&!globalThis.isSecureContext)return{allowed:!1,reason:"not-secure-context"};let t=navigator.userAgent??"",r=await De(),a=I(r,"Microsoft Edge")??I(r,"Microsoft Edge WebView2"),n=I(r,"Google Chrome")??I(r,"Chromium"),o=!!a||/\bEdg\//i.test(t)||/\bEdgiOS\//i.test(t),i=/\bOPR\//i.test(t),u=/\bVivaldi\//i.test(t),l=/\bSamsungBrowser\//i.test(t),s=/\bFirefox\//i.test(t),d=!/\bChrome\//i.test(t)&&/\bSafari\//i.test(t)&&!/\bChromium\//i.test(t),g=ze()||/\bBrave\//i.test(t);if(o||i||u||l||s||d||g)return{allowed:!1,reason:o?"edge":g?"brave":s?"firefox":d?"safari":i?"opera":u?"vivaldi":l?"samsung":"unsupported-browser"};let y=re(n)??Ue(t),p=te[e];return p?y?y<p?{allowed:!1,reason:`chrome-too-old-${y}-lt-${p}`,chromeMajor:y}:{allowed:!0,reason:"ok",chromeMajor:y}:{allowed:!1,reason:"unknown-chrome-version"}:{allowed:!1,reason:"no-min-version",chromeMajor:y}}async function ne(e,t){try{let r=await We(e),a=`browser-gate:${r.reason}${r.chromeMajor?` (chrome ${r.chromeMajor})`:""}`;if(!r.allowed)return{available:!1,status:"unavailable",reason:a};switch(e){case"writer":{if(!x("Writer")||!Writer?.availability)return{available:!1,status:"api-not-present",reason:a};let n=await Writer.availability(t);return{available:n!=="unavailable",status:n,reason:a}}case"rewriter":{if(!x("Rewriter")||!Rewriter?.availability)return{available:!1,status:"api-not-present",reason:a};let n=await Rewriter.availability(t);return{available:n!=="unavailable",status:n,reason:a}}case"summarizer":{if(!x("Summarizer")||!Summarizer?.availability)return{available:!1,status:"api-not-present",reason:a};let n=await Summarizer.availability(t);return{available:n!=="unavailable",status:n,reason:a}}case"proofreader":{if(!x("Proofreader")||!Proofreader?.availability)return{available:!1,status:"api-not-present",reason:a};let n=await Proofreader.availability(t);return{available:n!=="unavailable",status:n,reason:a}}case"language-detector":{if(!x("LanguageDetector")||!LanguageDetector?.availability)return{available:!1,status:"api-not-present",reason:a};let n=await LanguageDetector.availability(t);return{available:n!=="unavailable",status:n,reason:a}}case"translator":{if(!x("Translator")||!Translator?.availability)return{available:!1,status:"api-not-present",reason:a};let n=t;if(!n?.sourceLanguage||!n?.targetLanguage)return{available:!1,status:"error",reason:a,error:new Error("Translator.availability requires sourceLanguage/targetLanguage")};let o=await Translator.availability({...n,sourceLanguage:n.sourceLanguage==="auto"?"en":n.sourceLanguage,targetLanguage:n.sourceLanguage==="auto"||n.sourceLanguage===n.targetLanguage?"hu":n.targetLanguage});return{available:o!=="unavailable",status:o,reason:a}}case"prompt":{if(!x("LanguageModel")||!LanguageModel?.availability)return{available:!1,status:"api-not-present",reason:a};let n=await LanguageModel.availability(t);return{available:n!=="unavailable",status:n,reason:a}}default:return{available:!1,status:"unknown-feature",reason:a}}}catch(r){return{available:!1,status:"error",reason:"exception in availability()",error:r}}}async function M(e,t,r){let a=await Y(),n=r||Ie(a),o=await Me(),i=await ne(e,t),u=i.available,l=o.available,s={feature:e,mode:n,onDeviceAvailable:u,onDeviceStatus:i.status,onDeviceReason:i.reason,backendAvailable:l,backendTransport:o.transport,backendApiName:o.apiName,backendBaseUrl:o.baseUrl,backendReason:o.reason};return n==="local-only"?u?{...s,source:"on-device",reason:`local-only: on-device available (${i.reason??i.status})`}:{...s,source:"none",reason:`local-only: on-device unavailable (${i.reason??i.status})`}:n==="backend-only"?l?{...s,source:"backend",reason:`backend-only: backend available (${o.reason??"n/a"})`}:{...s,source:"none",reason:`backend-only: backend unavailable (${o.reason??"n/a"})`}:u?{...s,source:"on-device",reason:`backend-fallback: using on-device (${i.reason??i.status})`}:l?{...s,source:"backend",reason:`backend-fallback: using backend (${o.reason??"n/a"}; on-device: ${i.reason??i.status})`}:{...s,source:"none",reason:`No on-device AI or backend available (on-device: ${i.reason??i.status}; backend: ${o.reason??"n/a"})`}}var Fe,te,_=h(()=>{"use strict";F();Fe=Ee();te={summarizer:138,translator:138,"language-detector":138,writer:137,rewriter:137,proofreader:141,prompt:138}});var oe={};U(oe,{dispatchBackend:()=>q,withRecaptchaHeaders:()=>O});import{getRecaptcha as Ne}from"@smart-cloud/wpsuite-core";function _e(){return globalThis.WpSuite?.plugins?.aiKit?.settings??{}}async function qe(e){if(e!=="frontend")return;let t=_e();if(!t?.reCaptchaSiteKey)return;let{execute:r}=await Ne(t?.useRecaptchaEnterprise||!1);if(typeof r=="function")try{let n=await r(t.reCaptchaSiteKey,{action:"generate"});return typeof n=="string"&&n?n:void 0}catch{return}}async function O(e,t){if(e!=="frontend"||t["X-Recaptcha-Token"]||t["x-recaptcha-token"])return t;let r=await qe(e);return r?{...t,"X-Recaptcha-Token":r}:t}function T(e,t){try{e?.onStatus?.(t)}catch{}}function $e(e){return typeof e=="object"&&e!==null&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null)}function Ge(e,t){if(!$e(t))return t;let r=je[e];if(!r)return t;let a={};for(let n of r)n in t&&(a[n]=t[n]);return a}function Xe(e,t){return(e==="admin"?He:Ve)[t]}async function q(e,t,r,a,n={}){let o=Xe(t,r),i=Ge(r,a);if(!o)throw new P(`No backend path configured for "${r}" (${t}).`,e);if(e.backendTransport==="fetch"){if(!e.backendBaseUrl)throw new P("backendTransport=fetch but backendBaseUrl is missing.",e);return Je(e.backendBaseUrl,o,i,n,e,r,t)}if(!e.backendApiName)throw new P("backendTransport=gatey but backendApiName is missing.",e);return Ze(e.backendApiName,o,i,n,e,r,t)}async function Je(e,t,r,a,n,o,i){let u=`${e.replace(/\/+$/,"")}${t}`,l={"content-type":"application/json",...a.headers??{}},s=await O(i,l),d=a.query&&Object.keys(a.query).length>0?"?"+new URLSearchParams(Object.entries(a.query).map(([p,w])=>[p,String(w)])).toString():"";T(a,{feature:o,context:i,step:"backend:request",source:"backend"}),T(a,{feature:o,context:i,step:"backend:waiting",source:"backend"});let g=await fetch(u+d,{method:"POST",headers:s,body:JSON.stringify(r??{}),signal:a.signal,credentials:"omit"});if(T(a,{feature:o,context:i,step:"backend:response",source:"backend"}),!g.ok){let p=`HTTP ${g.status}`;try{let w=await g.text();w&&(p=`${p}: ${w.substring(0,400)}`)}catch{}throw new P(`Fetch backend call failed: ${p}`,n,g.status)}return(g.headers.get("content-type")||"").includes("application/json")?await g.json():await g.text()}async function Ze(e,t,r,a,n,o,i){let l=globalThis.WpSuite?.plugins?.gatey;if(!l?.cognito?.post)throw new P("Gatey backend selected, but Gatey.cognito.post is not available.",n);let s=await O(i,{...a.headers??{}});T(a,{feature:o,context:i,step:"backend:request",source:"backend"}),T(a,{feature:o,context:i,step:"backend:waiting",source:"backend"});let d=l.cognito.post({apiName:e,path:t,options:{body:r,headers:s}});a?.signal?.addEventListener?.("abort",()=>{d.cancel()});let g=await d.response.then(y=>y.body.json());return T(a,{feature:o,context:i,step:"backend:response",source:"backend"}),g}var je,He,Ve,$=h(()=>{"use strict";N();je={prompt:["text","context","responseConstraint","sessionId","images","imageUrls","rejected","knowledgeBaseId","disableKB","enableRerank","kb_filters"],writer:["text","outputLanguage","instruction","context","tone","format","length","knowledgeBaseId","disableKB"],rewriter:["text","outputLanguage","instruction","context","tone","format","length"],summarizer:["text","outputLanguage","instruction","context","type","format","length"],translator:["text","sourceLanguage","targetLanguage"],"language-detector":["text","maxCandidates"],proofreader:["text","expectedInputLanguages"]};He={prompt:"/admin/prompt",writer:"/admin/write",rewriter:"/admin/rewrite",summarizer:"/admin/summarize",translator:"/admin/translate","language-detector":"/admin/detect-language",proofreader:"/admin/proofread"},Ve={prompt:"/frontend/prompt",writer:"/frontend/write",rewriter:"/frontend/rewrite",summarizer:"/frontend/summarize",translator:"/frontend/translate","language-detector":"/frontend/detect-language",proofreader:"/frontend/proofread"}});var me={};U(me,{detectLanguage:()=>dt,getPromptOptions:()=>pe,getProofreadOptions:()=>ce,getRewriteOptions:()=>le,getSummarizeOptions:()=>de,getTranslateOptions:()=>ge,getWriteOptions:()=>ue,prompt:()=>ht,proofread:()=>lt,rewrite:()=>ut,summarize:()=>ct,translate:()=>K,write:()=>st});import{getWpSuite as Qe}from"@smart-cloud/wpsuite-core";function C(){return(ie?.plugins?.aiKit?.settings??{}).defaultOutputLanguage??"en"}function B(e){let t=["en","ja","es"],r=e.toLowerCase();return t.some(a=>r===a.toLowerCase())}function c(e,t,r,a){try{r?.onStatus?.({feature:e,context:t,...a})}catch{}}function D(){return ie?.plugins?.aiKit?.settings?.sharedContext??void 0}function L(e){return e?.context??"admin"}function se(e){let t=e;return{knowledgeBaseId:typeof t.knowledgeBaseId=="string"?t.knowledgeBaseId:void 0,disableKB:typeof t.disableKB=="boolean"?t.disableKB:void 0}}function Ye(e){return typeof e=="string"?e:e.map(t=>`${t.role.toUpperCase()}: ${t.content}`).join(`

`)}async function et(e,t,r,a){let n=se(e),o=await Ct(e.images,r,t,a);return{text:Ye(e.messages),images:o?.images,imageUrls:o?.imageUrls,context:e.sharedContext,responseConstraint:e.responseConstraint,...n}}function tt(e){let t=se(e);return{text:e.prompt,outputLanguage:e.outputLanguage,instruction:e.context?.trim()?e.context.trim():void 0,context:e.sharedContext,tone:e.tone,format:e.format,length:e.length,...t}}function rt(e){return{text:e.text,outputLanguage:e.outputLanguage,instruction:e.context?.trim()?e.context.trim():void 0,context:e.sharedContext,tone:e.tone,format:e.format,length:e.length}}function nt(e){return{text:e.text,outputLanguage:e.outputLanguage,instruction:e.context?.trim()?e.context.trim():void 0,context:e.sharedContext,type:e.type,format:e.format,length:e.length}}function at(e,t,r){return{text:e,sourceLanguage:t,targetLanguage:r}}function ot(e,t){let r=t;return{text:e,maxCandidates:typeof r?.maxCandidates=="number"?r.maxCandidates:void 0}}function it(e){return{text:e.text,expectedInputLanguages:e.expectedInputLanguages}}async function S(e,t,r,a,n,o,i){c(r,e,i,{step:"decide",message:"Deciding capability"});let u=await M(r,a,t);if(c(r,e,i,{step:"decide",source:u.source,message:`Using ${u.source}`}),u.source==="on-device")try{c(r,e,i,{step:"on-device:init",source:"on-device"});let l=await n();return c(r,e,i,{step:"done",source:"on-device"}),l}catch(l){console.error(`Error in on-device ${r}:`,l),c(r,e,i,{step:"error",source:"on-device",message:l.message}),i?.signal?.throwIfAborted()}if(u.mode!=="local-only"&&u.backendAvailable){c(r,e,i,{step:"backend:request",source:"backend"});let l=typeof o=="function"?await o(u):o,s=await q(u,e,r,l,i);return c(r,e,i,{step:"done",source:"backend"}),s}throw new Error(`No capability for "${r}" (${e}). Reason: ${u.reason}`)}function gt(e){let t=Array.isArray(e.images)&&e.images.length>0,r=e.images??[],a=t?r.map(o=>({type:"image",value:o})):[],n;if(typeof e.messages=="string")n=t?[{role:"user",content:[{type:"text",value:e.messages},...a]}]:e.messages;else{let o=e.messages.filter(i=>i.role!=="system").map(i=>({role:i.role==="assistant"?"assistant":"user",content:i.content}));if(t){let i=-1;for(let u=o.length-1;u>=0;u--)if(o[u].role==="user"){i=u;break}if(i===-1)o.push({role:"user",content:[{type:"text",value:""},...a]});else{let u=String(o[i].content??"");o[i]={...o[i],content:[{type:"text",value:u},...a]}}}n=o}return n}function mt(e){return typeof Blob<"u"&&e instanceof Blob}function ft(e){let t=(e??"").toLowerCase();return t.includes("png")?"png":t.includes("webp")?"webp":t.includes("gif")?"gif":t.includes("bmp")?"bmp":"jpg"}function bt(e){let t=(e??"").toLowerCase();return t.includes("png")?"png":t.includes("webp")?"webp":t.includes("gif")?"gif":"jpeg"}async function yt(e){return new Promise((t,r)=>{let a=new FileReader;a.onerror=()=>r(a.error??new Error("FileReader error")),a.onload=()=>t(String(a.result??"")),a.readAsDataURL(e)})}async function wt(e){let t=await yt(e),r=t.indexOf(",");return r>=0?t.substring(r+1):t}async function vt(e,t,r,a,n,o){let i=t==="admin"?"/admin/generate-upload-url":"/frontend/generate-upload-url",u={...o?.headers??{}},l=await O(t,u);if(e.backendTransport==="fetch"){if(!e.backendBaseUrl)throw new Error("backendBaseUrl missing for fetch transport");let p=new URLSearchParams({fileName:r,contentType:a,contentLength:String(n)}).toString(),w=`${e.backendBaseUrl.replace(/\/+$/,"")}${i}?${p}`,v=await fetch(w,{method:"GET",headers:l,signal:o?.signal,credentials:"omit"});if(!v.ok){let G=await v.text().catch(()=>"");throw new Error(`generate-upload-url failed (fetch): HTTP ${v.status}${G?": "+G.substring(0,200):""}`)}let k=await v.json();if(!k?.uploadUrl||!k?.imageKey)throw new Error("generate-upload-url response missing uploadUrl/imageKey");return{uploadUrl:k.uploadUrl,imageKey:k.imageKey}}if(!e.backendApiName)throw new Error("backendApiName missing for gatey transport");let s=globalThis.WpSuite?.plugins?.gatey,d={fileName:r,contentType:a,contentLength:n};if(s?.cognito?.get){let p=await s.cognito.get({apiName:e.backendApiName,path:i,options:{queryParams:Object.keys(d).reduce((v,k)=>(v[k]=String(d[k]),v),{}),headers:l}});o?.signal?.addEventListener?.("abort",()=>{p.cancel()});let w=await p.response.then(v=>v.body.json());if(!w?.uploadUrl||!w?.imageKey)throw new Error("generate-upload-url (gatey get) response missing uploadUrl/imageKey");return{uploadUrl:w.uploadUrl,imageKey:w.imageKey}}if(!s?.cognito?.post)throw new Error("Gatey.cognito.post is not available");let g=s.cognito.post({apiName:e.backendApiName,path:i,options:{body:d,headers:l}});o?.signal?.addEventListener?.("abort",()=>{g.cancel()});let y=await g.response.then(p=>p.body.json());if(!y?.uploadUrl||!y?.imageKey)throw new Error("generate-upload-url (gatey post) response missing uploadUrl/imageKey");return{uploadUrl:y.uploadUrl,imageKey:y.imageKey}}async function At(e,t,r,a){let n=await fetch(e,{method:"PUT",headers:{"Content-Type":r||"application/octet-stream"},body:t,signal:a?.signal});if(!n.ok){let o=await n.text().catch(()=>"");throw new Error(`S3 upload failed: HTTP ${n.status}${o?": "+o.substring(0,200):""}`)}}async function Ct(e,t,r,a){if(!e||e.length===0)return;let n=[];for(let s of e){if(!mt(s))throw new Error("Backend multimodal prompting currently supports only Blob/File inputs for images.");n.push(s)}let o=n.reduce((s,d)=>s+(d.size||0),0);if(Math.ceil(o*1.37+2048*n.length)<=pt){c("prompt",r,a,{step:"backend:request",source:"backend",message:"Inlining images as base64"});let s=[];for(let d of n)s.push({format:bt(d.type),data:await wt(d)});return{images:s}}c("prompt",r,a,{step:"backend:request",source:"backend",message:"Uploading images via signed URL"});let l=[];for(let s=0;s<n.length;s++){let d=n[s],g=d.type||"application/octet-stream",y=d.name||`image_${s}.${ft(g)}`;c("prompt",r,a,{step:"backend:request",source:"backend",message:"Requesting signed URL"});let{uploadUrl:p,imageKey:w}=await vt(t,r,y,g,d.size||0,a);c("prompt",r,a,{step:"backend:waiting",source:"backend",message:"Uploading"}),await At(p,d,g,a),l.push(w)}return{imageUrls:l}}var ie,ue,st,le,ut,ce,lt,de,ct,dt,ge,K,pt,pe,ht,fe=h(()=>{"use strict";$();_();ye();ie=Qe();ue=e=>{let t=e.outputLanguage?e.outputLanguage:C(),r={tone:e.tone,format:e.format,length:e.length,outputLanguage:t};return Promise.resolve(r)},st=async(e,t)=>{let r=L(t),a=e.sharedContext??D(),n=e.outputLanguage?e.outputLanguage:C(),o=n,i=!1;B(n)||(i=!0,n="en");let u=ue({...e,outputLanguage:n});return S(r,t?.modeOverride,"writer",u,async()=>{if(typeof Writer>"u")throw new Error("Writer API not available in this browser.");c("writer",r,t,{step:"on-device:init",source:"on-device",message:"Creating Writer session"});let l=await Writer.create({...u,sharedContext:a,monitor(s){s.addEventListener("downloadprogress",d=>{let g=d.loaded;c("writer",r,t,{step:"on-device:download",source:"on-device",progress:g,loaded:g})})}});c("writer",r,t,{step:"on-device:ready",source:"on-device"});try{c("writer",r,t,{step:"on-device:run",source:"on-device",message:"Generating text"});let s=await l.write(e.prompt,{context:e.context,signal:t?.signal});return i?{result:(await K({text:s,sourceLanguage:n,targetLanguage:o})).result}:{result:s}}finally{try{l.destroy()}catch(s){console.error("Error destroying writer:",s)}}},tt({...e,sharedContext:a,outputLanguage:o}),t)},le=e=>{let t=e.outputLanguage?e.outputLanguage:C(),r={tone:e.tone,format:e.format,length:e.length,outputLanguage:t};return Promise.resolve(r)},ut=async(e,t)=>{let r=L(t),a=e.sharedContext??D(),n=e.outputLanguage?e.outputLanguage:C(),o=n,i=!1;B(n)||(i=!0,n="en");let u=le({...e,outputLanguage:n});return S(r,t?.modeOverride,"rewriter",u,async()=>{if(typeof Rewriter>"u")throw new Error("Rewriter API not available in this browser.");c("rewriter",r,t,{step:"on-device:init",source:"on-device",message:"Creating Rewriter session"});let l=await Rewriter.create({...u,sharedContext:a,monitor(s){s.addEventListener("downloadprogress",d=>{let g=d.loaded;c("rewriter",r,t,{step:"on-device:download",source:"on-device",progress:g,loaded:g})})}});c("rewriter",r,t,{step:"on-device:ready",source:"on-device"});try{c("rewriter",r,t,{step:"on-device:run",source:"on-device",message:"Rewriting text"});let s=await l.rewrite(e.text,{context:e.context,signal:t?.signal});return i?{result:(await K({text:s,sourceLanguage:n,targetLanguage:o})).result}:{result:s}}finally{try{l.destroy()}catch(s){console.error("Error destroying rewriter:",s)}}},rt({...e,sharedContext:a,outputLanguage:o}),t)},ce=()=>Promise.resolve({includeCorrectionTypes:!0,includeCorrectionExplanations:!0}),lt=async(e,t)=>{let r=L(t),a=await ce();return S(r,t?.modeOverride,"proofreader",a,async()=>{if(typeof Proofreader>"u")throw new Error("Proofreader API not available in this browser.");c("proofreader",r,t,{step:"on-device:init",source:"on-device",message:"Creating Proofreader session"});let n=await Proofreader.create({...a,monitor(o){o.addEventListener("downloadprogress",i=>{let u=i.loaded;c("proofreader",r,t,{step:"on-device:download",source:"on-device",progress:u,loaded:u})})}});c("proofreader",r,t,{step:"on-device:ready",source:"on-device"});try{return c("proofreader",r,t,{step:"on-device:run",source:"on-device",message:"Proofreading"}),{result:await n.proofread(e.text,{signal:t?.signal})}}finally{try{n.destroy()}catch(o){console.error("Error destroying proofreader:",o)}}},it(e),t)},de=e=>{let t=e.outputLanguage?e.outputLanguage:C(),r={type:e.type,format:e.format,length:e.length,outputLanguage:t};return Promise.resolve(r)},ct=async(e,t)=>{let r=L(t),a=e.sharedContext??D(),n=e.outputLanguage?e.outputLanguage:C(),o=n,i=!1;B(n)||(i=!0,n="en");let u=await de({...e,outputLanguage:n});return S(r,t?.modeOverride,"summarizer",u,async()=>{if(typeof Summarizer>"u")throw new Error("Summarizer API not available in this browser.");c("summarizer",r,t,{step:"on-device:init",source:"on-device",message:"Creating Summarizer session"});let l=await Summarizer.create({...u,sharedContext:a,monitor(s){s.addEventListener("downloadprogress",d=>{let g=d.loaded;c("summarizer",r,t,{step:"on-device:download",source:"on-device",progress:g,loaded:g})})}});c("summarizer",r,t,{step:"on-device:ready",source:"on-device"});try{c("summarizer",r,t,{step:"on-device:run",source:"on-device",message:"Summarizing"});let s=await l.summarize(e.text,{context:e.context,signal:t?.signal});return i?{result:(await K({text:s,sourceLanguage:n,targetLanguage:o})).result}:{result:s}}finally{try{l.destroy()}catch(s){console.error("Error destroying summarizer:",s)}}},nt({...e,sharedContext:a,outputLanguage:o}),t)},dt=async(e,t)=>{let r=L(t);return S(r,t?.modeOverride,"language-detector",void 0,async()=>{if(typeof LanguageDetector>"u")throw new Error("LanguageDetector API not available in this browser.");c("language-detector",r,t,{step:"on-device:init",source:"on-device",message:"Creating LanguageDetector session"});let a=await LanguageDetector.create({monitor(n){n.addEventListener("downloadprogress",o=>{let i=o.loaded;c("language-detector",r,t,{step:"on-device:download",source:"on-device",progress:i,loaded:i})})}});c("language-detector",r,t,{step:"on-device:ready",source:"on-device"});try{return c("language-detector",r,t,{step:"on-device:run",source:"on-device",message:"Detecting language"}),{result:{candidates:(await a.detect(e.text,{signal:t?.signal})).filter(o=>be.find(i=>i.value===o.detectedLanguage))}}}finally{try{a.destroy()}catch(n){console.error("Error destroying language detector:",n)}}},ot(e.text,t),t)},ge=e=>{let t={sourceLanguage:e.sourceLanguage??"auto",targetLanguage:e.targetLanguage??C()??"en"};return Promise.resolve(t)},K=async(e,t)=>{let r=L(t),a=await ge({...e});return S(r,t?.modeOverride,"translator",a,async()=>{if(typeof Translator>"u")throw new Error("Translator API not available in this browser.");c("translator",r,t,{step:"on-device:init",source:"on-device",message:"Creating Translator session"});let n=await Translator.create({...a,monitor(o){o.addEventListener("downloadprogress",i=>{let u=i.loaded;c("translator",r,t,{step:"on-device:download",source:"on-device",progress:u,loaded:u})})}});c("translator",r,t,{step:"on-device:ready",source:"on-device"});try{c("translator",r,t,{step:"on-device:run",source:"on-device",message:"Translating"});let o=[];return e.text.split(`
`).forEach(u=>o.push(n.translate(u.trim()))),{result:(await Promise.all(o)).join(`
`)}}finally{try{n.destroy()}catch(o){console.error("Error destroying translator:",o)}}},at(e.text,e.sourceLanguage,e.targetLanguage),t)};pt=4*1024*1024;pe=async e=>{let t=e.outputLanguage?e.outputLanguage:C();return B(t)||(t="en"),{topK:e.topK,temperature:e.temperature,expectedInputs:[{type:"text"},{type:"image"}],expectedOutputs:[{type:"text",languages:[t]}]}},ht=async(e,t)=>{let r=L(t),a=e.sharedContext??D(),n=e.outputLanguage?e.outputLanguage:C(),o=n,i=!1;B(n)||(i=!0,n="en");let u=await pe({...e,outputLanguage:n}),l=await M("prompt",u,t?.modeOverride);return S(r,t?.modeOverride,"prompt",u,async()=>{if(typeof LanguageModel>"u")throw new Error("LanguageModel API not available in this browser.");c("prompt",r,t,{step:"on-device:init",source:"on-device",message:"Creating LanguageModel session"});let s=[];if(typeof e.messages!="string"){for(let p of e.messages)p.role==="system"&&p.content.trim()&&s.push(p.content.trim());a&&a.trim()&&s.push("SHARED CONTEXT: "+a.trim())}let d=s.length>0?s.join(`

`):void 0,g=d?[{role:"system",content:d}]:void 0,y=await LanguageModel.create({...u,initialPrompts:g,monitor(p){p.addEventListener("downloadprogress",w=>{let v=w.loaded;c("prompt",r,t,{step:"on-device:download",source:"on-device",progress:v,loaded:v})})}});c("prompt",r,t,{step:"on-device:ready",source:"on-device"});try{c("prompt",r,t,{step:"on-device:run",source:"on-device",message:"Generating text"});let p=await y.prompt(gt(e),{signal:t?.signal,responseConstraint:e.responseConstraint});return i?{result:(await K({text:p,sourceLanguage:n,targetLanguage:o})).result}:{result:p}}finally{try{y.destroy()}catch(p){console.error("Error destroying LanguageModel:",p)}}},await et({...e,sharedContext:a},r,l,t),t)}});import{attachDefaultPluginRuntime as Pt,TEXT_DOMAIN as m}from"@smart-cloud/wpsuite-core";import{__ as f}from"@wordpress/i18n";var be,j,Jt,Zt,Qt,kt,Yt,b,er,tr,rr,nr,ar,or,ir,sr,ur,lr,cr,dr,gr,pr,ye=h(()=>{z();F();F();N();Q();be=[{label:f("Arabic",m),value:"ar"},{label:f("Chinese",m),value:"zh"},{label:f("Dutch",m),value:"nl"},{label:f("English",m),value:"en"},{label:f("French",m),value:"fr"},{label:f("German",m),value:"de"},{label:f("Hebrew",m),value:"he"},{label:f("Hindi",m),value:"hi"},{label:f("Hungarian",m),value:"hu"},{label:f("Indonesian",m),value:"id"},{label:f("Italian",m),value:"it"},{label:f("Japanese",m),value:"ja"},{label:f("Korean",m),value:"ko"},{label:f("Norwegian",m),value:"no"},{label:f("Polish",m),value:"pl"},{label:f("Portuguese",m),value:"pt"},{label:f("Russian",m),value:"ru"},{label:f("Spanish",m),value:"es"},{label:f("Swedish",m),value:"sv"},{label:f("Thai",m),value:"th"},{label:f("Turkish",m),value:"tr"},{label:f("Ukrainian",m),value:"uk"}],j=Promise.resolve().then(()=>(_(),ae)),Jt=async()=>(await j).MIN_CHROME_VERSION,Zt=async(...e)=>(await j).decideCapability(...e),Qt=async(...e)=>(await j).checkOnDeviceAvailability(...e),kt=Promise.resolve().then(()=>($(),oe)),Yt=async(...e)=>(await kt).dispatchBackend(...e),b=Promise.resolve().then(()=>(fe(),me)),er=async(...e)=>(await b).getWriteOptions(...e),tr=async(...e)=>(await b).write(...e),rr=async(...e)=>(await b).getRewriteOptions(...e),nr=async(...e)=>(await b).rewrite(...e),ar=async(...e)=>(await b).getProofreadOptions(...e),or=async(...e)=>(await b).proofread(...e),ir=async(...e)=>(await b).getSummarizeOptions(...e),sr=async(...e)=>(await b).summarize(...e),ur=async(...e)=>(await b).getTranslateOptions(...e),lr=async(...e)=>(await b).translate(...e),cr=async(...e)=>(await b).detectLanguage(...e),dr=async(...e)=>(await b).getPromptOptions(...e),gr=async(...e)=>(await b).prompt(...e),pr=e=>{let t=globalThis.WpSuite,r=R();if(!r)throw console.error("AiKit plugin is not available"),new Error("AiKit plugin is not available");Pt(r),r.status=r.status??"initializing";let a=J();return r.features={store:a,renderFeature:async n=>await e({...n,store:await a}),write:async(...n)=>{let o=await b,i=n[1]||{};return n[1]={context:"frontend",...i},o.write(...n)},rewrite:async(...n)=>{let o=await b,i=n[1]||{};return n[1]={context:"frontend",...i},o.rewrite(...n)},proofread:async(...n)=>{let o=await b,i=n[1]||{};return n[1]={context:"frontend",...i},o.proofread(...n)},summarize:async(...n)=>{let o=await b,i=n[1]||{};return n[1]={context:"frontend",...i},o.summarize(...n)},translate:async(...n)=>{let o=await b,i=n[1]||{};return n[1]={context:"frontend",...i},o.translate(...n)},detectLanguage:async(...n)=>{let o=await b,i=n[1]||{};return n[1]={context:"frontend",...i},o.detectLanguage(...n)},prompt:async(...n)=>{let o=await b,i=n[1]||{};return n[1]={context:"frontend",...i},o.prompt(...n)}},a.then(()=>{r.status="available",t?.events?.emit("wpsuite:ai-kit:ready",{key:r.key,version:r.version})}).catch(n=>{r.status="error",console.error("AiKit plugin failed to initialize:",n),t?.events?.emit("wpsuite:ai-kit:error",{key:r.key,error:String(n)})}),r}});ye();export{It as AiKitChatbotIcon,Ft as AiKitFeatureIcon,P as BackendError,be as LANGUAGE_OPTIONS,m as TEXT_DOMAIN,Qt as checkOnDeviceAvailability,Zt as decideCapability,cr as detectLanguage,Yt as dispatchBackend,R as getAiKitPlugin,Jt as getMinChromeVersions,dr as getPromptOptions,ar as getProofreadOptions,rr as getRewriteOptions,ve as getStore,Be as getStoreDispatch,E as getStoreSelect,ir as getSummarizeOptions,ur as getTranslateOptions,er as getWriteOptions,pr as initializeAiKit,Ke as observeStore,gr as prompt,or as proofread,nr as rewrite,X as sanitizeAiKitConfig,sr as summarize,lr as translate,H as waitForAiKitReady,tr as write};
