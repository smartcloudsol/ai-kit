"use strict";(globalThis.webpackChunk_smart_cloud_ai_kit_admin=globalThis.webpackChunk_smart_cloud_ai_kit_admin||[]).push([[202],{1202(e,a,s){s.r(a),s.d(a,{default:()=>g});var n=s(8790),t=s(9086),l=s(7641),o=s(7693),i=s(899),c=s(7723),d=s(988),r=s(1609),b=s(8354),k=s(4200),m=s(9069),p=s(3226),u=s(790);const h=b.Ikc({mode:b.k5n(["local-only","backend-fallback","backend-only"]).default("local-only"),backendTransport:b.k5n(["gatey","fetch"]).optional(),backendApiName:b.YjP().optional(),backendBaseUrl:b.YjP().optional()}).superRefine((e,a)=>{"local-only"!==e.mode&&(e.backendTransport?("gatey"!==e.backendTransport||e.backendApiName||a.addIssue({code:b.eqx.custom,path:["backendApiName"],message:"Required"}),"fetch"!==e.backendTransport||e.backendBaseUrl||a.addIssue({code:b.eqx.custom,path:["backendBaseUrl"],message:"Required"})):a.addIssue({code:b.eqx.custom,path:["backendTransport"],message:"Required"}))});function g({apiUrl:e,config:a,accountId:s,siteId:b,siteKey:g,onSave:f,InfoLabelComponent:x}){var y;const[A,T]=(0,r.useState)(!1),j=(0,r.useMemo)(()=>(0,m.gF)(),[]),v=(0,r.useMemo)(()=>{try{var e;const a=null!==(e=j?.cognito?.getAmplifyConfig?.()?.API?.REST)&&void 0!==e?e:{};return Object.keys(a)}catch{return[]}},[j]),I=(0,n.useForm)({initialValues:{mode:null!==(y=a?.mode)&&void 0!==y?y:"local-only",backendTransport:a?.backendTransport,backendApiName:a?.backendApiName,backendBaseUrl:a?.backendBaseUrl},validate:(0,d.s)(h)});(0,r.useEffect)(()=>{var e;a&&I.setValues({mode:null!==(e=a.mode)&&void 0!==e?e:"local-only",backendTransport:a.backendTransport,backendApiName:a.backendApiName,backendBaseUrl:a.backendBaseUrl})},[a]);const S=(0,r.useCallback)(e=>{const a=null!=e?e:void 0;I.setFieldValue("backendTransport",a),"gatey"===a&&I.setFieldValue("backendBaseUrl",""),"fetch"===a&&I.setFieldValue("backendApiName","")},[I]),w=(0,r.useCallback)(async o=>{if(s&&b&&g){T(!0);try{const l={...{...a,mode:o.mode,backendTransport:"local-only"===o.mode?void 0:o.backendTransport,backendApiName:"local-only"===o.mode||"gatey"!==o.backendTransport?void 0:o.backendApiName,backendBaseUrl:"local-only"===o.mode||"fetch"!==o.backendTransport?void 0:o.backendBaseUrl}};delete l.subscriptionType;const i=await async function(e,a,s,n,t){const l=await fetch(`${e}/account/${a}/site/${s}/settings`,{method:"PUT",headers:{"Content-Type":"application/json","X-Site-Key":n,"X-Plugin":"ai-kit"},body:JSON.stringify({settings:t})});if(!l.ok){const e=await l.text();throw new Error(e||`HTTP error! status: ${l.status}`)}return(await l.json()).settings}(e,s,b,g,l);f(i),n.notifications.show({title:(0,c.__)("Settings saved",k.Xg),message:(0,c.__)("API settings saved successfully.",k.Xg),color:"green",icon:(0,u.jsx)(t.A,{}),className:p.A.notification})}catch(e){console.error("Error saving API settings:",e),n.notifications.show({title:(0,c.__)("Error occured",k.Xg),message:e.message,color:"red",icon:(0,u.jsx)(l.A,{}),className:p.A.notification})}finally{T(!1)}}else console.error("Missing account ID or site ID or site key")},[s,b,g,a,e,f]),N=I.values.backendTransport,P="local-only"!==I.values.mode;return(0,u.jsx)("form",{name:"apisettings-editor",onSubmit:I.onSubmit(w),style:{maxWidth:900},children:(0,u.jsxs)(n.Stack,{gap:"md",children:[(0,u.jsx)(n.Card,{withBorder:!0,shadow:"sm",children:(0,u.jsxs)(n.Stack,{gap:"md",children:[(0,u.jsx)(n.Group,{align:"flex-start",justify:"space-between",children:(0,u.jsxs)("div",{children:[(0,u.jsx)(n.Title,{order:4,children:"AI-Kit API configuration"}),(0,u.jsx)(n.Text,{size:"sm",c:"dimmed",children:"Configure how AI-Kit should reach backend endpoints when needed."})]})}),(0,u.jsxs)(n.Group,{grow:!0,align:"flex-start",children:[(0,u.jsx)(n.Select,{classNames:{label:p.A["form-field-label"]},label:(0,u.jsx)(x,{text:"Mode",scrollToId:"aikit-api-mode"}),withAsterisk:!0,data:[{value:"local-only",label:"On-device only"},{value:"backend-fallback",label:"On-device + backend fallback"},{value:"backend-only",label:"Backend only"}],...I.getInputProps("mode")},I.key("mode")),(0,u.jsx)(n.Select,{classNames:{label:p.A["form-field-label"]},label:(0,u.jsx)(x,{text:"Backend connection",scrollToId:"aikit-api-backend-transport"}),withAsterisk:P,disabled:!P,data:[{value:"gatey",label:"Amplify REST (via WP Suite)"},{value:"fetch",label:"Direct base URL"}],value:null!=N?N:null,onChange:S,error:I.errors.backendTransport})]}),P&&"gatey"===N&&(0,u.jsxs)(n.Stack,{gap:6,children:[(0,u.jsx)(n.Select,{classNames:{label:p.A["form-field-label"]},label:(0,u.jsx)(x,{text:"REST API name",scrollToId:"aikit-api-backend-api-name"}),withAsterisk:!0,data:v,placeholder:v.length?"Select a REST API":"No REST APIs detected",disabled:!v.length,...I.getInputProps("backendApiName")},I.key("backendApiName")),(0,u.jsxs)(n.Text,{size:"xs",c:"dimmed",children:["Uses the REST API list from your Amplify configuration (",(0,u.jsx)("code",{children:"getAmplifyConfig().API.REST"}),")."]})]}),P&&"fetch"===N&&(0,u.jsxs)(n.Stack,{gap:6,children:[(0,u.jsx)(n.TextInput,{classNames:{label:p.A["form-field-label"]},label:(0,u.jsx)(x,{text:"Backend base URL",scrollToId:"aikit-api-backend-base-url"}),withAsterisk:!0,placeholder:"https://api.example.com",...I.getInputProps("backendBaseUrl")},I.key("backendBaseUrl")),(0,u.jsx)(n.Text,{size:"xs",c:"dimmed",children:"Enter the base URL of your AI-Kit backend (for example an API Gateway endpoint)."})]}),!P&&(0,u.jsxs)(n.Group,{gap:"xs",align:"center",children:[(0,u.jsx)(o.A,{size:16}),(0,u.jsxs)(n.Text,{size:"sm",c:"dimmed",children:["Backend is disabled in ",(0,u.jsx)("strong",{children:"On-device only"})," mode."]})]})]})}),(0,u.jsx)(n.Group,{justify:"flex-end",children:(0,u.jsx)(n.Button,{type:"submit",variant:"gradient",loading:A,leftSection:(0,u.jsx)(i.A,{size:16}),children:"Save API settings"})})]})})}}}]);