"use strict";(globalThis.webpackChunk_smart_cloud_ai_kit_admin=globalThis.webpackChunk_smart_cloud_ai_kit_admin||[]).push([[0],{3514(e,t,l){async function a(e,t,l,a,o){const s=await fetch(`${e}/account/${t}/site/${l}/settings`,{method:"PUT",headers:{"Content-Type":"application/json","X-Site-Key":a,"X-Plugin":"ai-kit"},body:JSON.stringify({settings:o})});if(!s.ok){const e=await s.text();throw new Error(e||`HTTP error! status: ${s.status}`)}return(await s.json()).settings}l.d(t,{D:()=>a})},8e3(e,t,l){l.r(t),l.d(t,{default:()=>f});var a=l(8790),o=l(4200),s=l(1139),n=l(7641),i=l(899),r=l(3),c=l(9208),d=l(2449),u=l(4225),h=l(7143),b=l(7723),v=l(1609),x=l(3226),g=l(3514),m=l(7391),p=l(790);m.F.putVocabularies(s.P9);const j=["userLabel","assistantLabel","sendLabel","cancelLabel","resetLabel","confirmLabel","clickAgainToConfirmLabel","notSentLabel","editLabel","readyLabel","readyEmptyLabel","addLabel","addImageLabel","removeImageLabel","closeChatLabel","maximizeLabel","restoreSizeLabel","referencesLabel","referenceLabel","acceptResponseLabel","rejectResponseLabel","emptyResponseLabel","unexpectedErrorLabel"];function f({apiUrl:e,config:t,accountId:l,siteId:f,siteKey:T,onSave:y,InfoLabelComponent:S,store:C}){var I,k,w,F,L,V,B,A,z,G,O,_,N,P,M,E,D,W,R;const[$,U]=(0,v.useState)(!1),H=(0,h.useSelect)(()=>(0,o.mI)(C).isShowChatbotPreview(),[C]),X=(0,h.useSelect)(()=>(0,o.mI)(C).getCustomTranslations(),[C]),K=(0,a.useForm)({initialValues:{enableChatbot:!!t?.enableChatbot,chatbot:null!==(I=t?.chatbot)&&void 0!==I?I:{},labels:null!==(k=t?.chatbot?.labels)&&void 0!==k?k:{}}});(0,v.useEffect)(()=>{m.F.putVocabularies(X||{})},[X]),(0,v.useEffect)(()=>{var e,l,a;t&&(K.setValues({enableChatbot:!!t.enableChatbot,chatbot:null!==(e=t.chatbot)&&void 0!==e?e:{},labels:null!==(l=t.chatbot?.labels)&&void 0!==l?l:{}}),m.F.setLanguage(null!==(a=t.chatbot?.language)&&void 0!==a?a:""))},[t]);const q=(0,v.useMemo)(()=>{var e,l;return{...null!==(e=t?.chatbot)&&void 0!==e?e:{},...null!==(l=K.values.chatbot)&&void 0!==l?l:{},labels:K.values.labels,previewMode:!0}},[t,K.values.chatbot,K.values.labels]),J=(0,v.useCallback)(async s=>{if(l&&f&&T){U(!0);try{var r,c;const n={...{...t,enableChatbot:s.enableChatbot,chatbot:{...null!==(r=t.chatbot)&&void 0!==r?r:{},...null!==(c=s.chatbot)&&void 0!==c?c:{},labels:s.labels}}};delete n.subscriptionType;const d=await(0,g.D)(e,l,f,T,n);y(d),a.notifications.show({title:(0,b.__)("Settings saved",o.Xg),message:(0,b.__)("Chatbot settings saved successfully.",o.Xg),color:"green",icon:(0,p.jsx)(i.A,{}),className:x.A.notification})}catch(e){a.notifications.show({title:(0,b.__)("Error occured",o.Xg),message:e.message,color:"red",icon:(0,p.jsx)(n.A,{}),className:x.A.notification})}finally{U(!1)}}},[l,f,T,t,e,y]),Q=Object.entries(null!==(w=K.values.labels)&&void 0!==w?w:{}).filter(([,e])=>"string"==typeof e),[Z,Y]=(0,v.useState)(null),[ee,te]=(0,v.useState)(""),le=j.filter(e=>{var t;return!(e in(null!==(t=K.values.labels)&&void 0!==t?t:{}))}).map(e=>({value:e,label:`${m.F.get(s.WG[e])} (${e})`})).sort((e,t)=>e.label.localeCompare(t.label)),ae=Array.from({length:10},(e,t)=>({value:String(t),label:String(t)})),oe=(0,v.useMemo)(()=>{const e=K.values.chatbot?.colors;return e&&"object"==typeof e?e:{}},[K.values.chatbot]),se=(0,v.useMemo)(()=>Object.entries(oe).filter(([e,t])=>"string"==typeof e&&"string"==typeof t).sort(([e],[t])=>e.localeCompare(t)),[oe]),ne=(0,v.useMemo)(()=>{const e=Object.keys(a.DEFAULT_THEME.colors),t=Object.keys(oe);return[...e,...t].filter((e,t,l)=>l.indexOf(e)===t).map(t=>({value:t,label:e.includes(t)?t:`${t} (custom)`}))},[oe]),ie=K.values.chatbot?.primaryShade,re="number"==typeof ie?{light:ie,dark:ie}:{light:"number"==typeof ie?.light?ie.light:6,dark:"number"==typeof ie?.dark?ie.dark:8},ce=re.light,de=re.dark,[ue,he]=(0,v.useState)(""),[be,ve]=(0,v.useState)("#228be6");return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("form",{name:"chatbotsettings-editor",onSubmit:K.onSubmit(J),style:{maxWidth:900},children:(0,p.jsxs)(a.Stack,{gap:"md",children:[(0,p.jsx)(a.Card,{withBorder:!0,shadow:"sm",children:(0,p.jsxs)(a.Stack,{gap:"md",children:[(0,p.jsxs)(a.Group,{align:"flex-start",justify:"space-between",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(a.Title,{order:4,children:"Chatbot configuration"}),(0,p.jsx)(a.Text,{size:"sm",c:"dimmed",children:"Enable/disable the chatbot, customize UI behavior and labels."})]}),(0,p.jsx)(a.Switch,{checked:H,onChange:e=>(0,o.Qk)(C).setShowChatbotPreview(e.currentTarget.checked),onLabel:(0,p.jsx)(c.A,{size:14}),offLabel:(0,p.jsx)(r.A,{size:14}),label:(0,p.jsx)(S,{text:"Preview",scrollToId:"chatbot-preview"})})]}),(0,p.jsx)(a.Switch,{label:(0,p.jsx)(S,{text:"Enable chatbot",scrollToId:"chatbot-enable"}),checked:K.values.enableChatbot,onChange:e=>K.setFieldValue("enableChatbot",e.currentTarget.checked)}),(0,p.jsx)(a.Divider,{}),(0,p.jsxs)(a.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,p.jsx)(a.TextInput,{label:(0,p.jsx)(S,{text:"Chat title",scrollToId:"chatbot-title"}),description:"Title shown at the top of the chat modal.",placeholder:m.F.get(s.WG.modalTitle),value:null!==(F=K.values.chatbot.title)&&void 0!==F?F:"",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,title:e.currentTarget.value})}),(0,p.jsx)(a.TextInput,{label:(0,p.jsx)(S,{text:"Placeholder",scrollToId:"chatbot-placeholder"}),description:"Input placeholder text shown above the message box.",placeholder:m.F.get(s.WG.placeholder),value:null!==(L=K.values.chatbot.placeholder)&&void 0!==L?L:"",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,placeholder:e.currentTarget.value})}),(0,p.jsx)(a.Select,{searchable:!0,clearable:!0,label:(0,p.jsx)(S,{text:"Language",scrollToId:"chatbot-language"}),description:"UI language for the chatbot. Leave empty to use defaults.",data:[{value:"",label:"--- Select ---"},...o.mN],value:null!==(V=K.values.chatbot.language)&&void 0!==V?V:"",onChange:e=>{m.F.setLanguage(null!=e?e:""),K.setFieldValue("chatbot",{...K.values.chatbot,language:e||void 0})}}),(0,p.jsx)(a.Select,{label:(0,p.jsx)(S,{text:"Direction",scrollToId:"chatbot-direction"}),description:'Text direction. "auto" follows the document direction.',data:[{value:"auto",label:"Auto"},{value:"ltr",label:"LTR"},{value:"rtl",label:"RTL"}],value:null!==(B=K.values.chatbot.direction)&&void 0!==B?B:"auto",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,direction:null!=e?e:"auto"})}),(0,p.jsx)(a.Select,{label:(0,p.jsx)(S,{text:"History storage",scrollToId:"chatbot-history-storage"}),description:"Where to persist chat history (cleared automatically after 24 hours).",data:[{value:"localstorage",label:"Local storage (default)"},{value:"sessionstorage",label:"Session storage"},{value:"nostorage",label:"No storage"}],value:null!==(A=K.values.chatbot.historyStorage)&&void 0!==A?A:"localstorage",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,historyStorage:null!=e?e:"localstorage"})})]})]})}),(0,p.jsx)(a.Card,{withBorder:!0,shadow:"sm",children:(0,p.jsxs)(a.Stack,{gap:"md",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(a.Title,{order:4,children:"Advanced"}),(0,p.jsx)(a.Text,{size:"sm",c:"dimmed",children:"Optional layout and limits."})]}),(0,p.jsxs)(a.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,p.jsx)(a.Select,{label:(0,p.jsx)(S,{text:"Open button position",scrollToId:"chatbot-openbutton-position"}),description:"Where the open button is placed on the page.",data:[{value:"bottom-right",label:"Bottom right"},{value:"bottom-left",label:"Bottom left"},{value:"top-right",label:"Top right"},{value:"top-left",label:"Top left"}],value:null!==(z=K.values.chatbot.openButtonPosition)&&void 0!==z?z:"bottom-right",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,openButtonPosition:null!=e?e:"bottom-right"})}),(0,p.jsx)(a.TextInput,{label:(0,p.jsx)(S,{text:"Open button label",scrollToId:"chatbot-openbutton-label"}),description:"Label shown on the open button.",value:null!==(G=K.values.chatbot.openButtonTitle)&&void 0!==G?G:"",placeholder:m.F.get(s.WG.askMeLabel),onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,openButtonTitle:e.currentTarget.value})}),(0,p.jsx)(a.Select,{label:(0,p.jsx)(S,{text:"Open button icon layout",scrollToId:"chatbot-openbutton-icon-layout"}),description:"Icon position relative to the title.",data:[{value:"top",label:"Top"},{value:"bottom",label:"Bottom"},{value:"left",label:"Left"},{value:"right",label:"Right"}],value:null!==(O=K.values.chatbot.openButtonIconLayout)&&void 0!==O?O:"top",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,openButtonIconLayout:null!=e?e:"top"})}),(0,p.jsx)(a.TextInput,{label:(0,p.jsx)(S,{text:"Open button icon (base64)",scrollToId:"chatbot-openbutton-icon"}),description:"Data URL (e.g. data:image/svg+xml;base64,...)",value:null!==(_=K.values.chatbot.openButtonIcon)&&void 0!==_?_:"",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,openButtonIcon:e.currentTarget.value})})]}),(0,p.jsxs)(a.Group,{mt:"md",gap:"xl",align:"center",children:[(0,p.jsx)(a.Switch,{label:(0,p.jsx)(S,{text:"Show open button title",scrollToId:"chatbot-openbutton-show-title"}),description:"Toggle the title visibility on the open button.",checked:null===(N=K.values.chatbot.showOpenButtonTitle)||void 0===N||N,onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,showOpenButtonTitle:e.currentTarget.checked})}),(0,p.jsx)(a.Switch,{label:(0,p.jsx)(S,{text:"Show open button icon",scrollToId:"chatbot-openbutton-show-icon"}),description:"Toggle the icon visibility on the open button.",checked:null===(P=K.values.chatbot.showOpenButtonIcon)||void 0===P||P,onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,showOpenButtonIcon:e.currentTarget.checked})})]}),(0,p.jsxs)(a.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,p.jsx)(a.NumberInput,{label:(0,p.jsx)(S,{text:"Max images",scrollToId:"chatbot-max-images"}),placeholder:"e.g. 3",min:0,value:null!==(M=K.values.chatbot?.maxImages)&&void 0!==M?M:void 0,onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,maxImages:"number"==typeof e?e:void 0})}),(0,p.jsx)(a.NumberInput,{label:(0,p.jsx)(S,{text:"Max image bytes",scrollToId:"chatbot-max-image-bytes"}),placeholder:"e.g. 2000000",min:0,value:null!==(E=K.values.chatbot?.maxImageBytes)&&void 0!==E?E:void 0,onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,maxImageBytes:"number"==typeof e?e:void 0})})]})]})}),(0,p.jsx)(a.Card,{withBorder:!0,shadow:"sm",children:(0,p.jsxs)(a.Stack,{gap:"md",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(a.Title,{order:4,children:(0,p.jsx)(S,{text:"Label overrides",scrollToId:"chatbot-label-overrides"})}),(0,p.jsx)(a.Text,{size:"sm",c:"dimmed",children:"Only the overridden labels are stored. Remove an override to fall back to defaults."})]}),0===Q.length&&(0,p.jsx)(a.Text,{size:"sm",c:"dimmed",children:"No overrides yet."}),Q.map(([e,t])=>(0,p.jsxs)(a.Group,{align:"flex-end",children:[(0,p.jsx)(a.TextInput,{label:`${m.F.get(s.WG[e])} (${e})`,value:t,placeholder:m.F.get(s.WG[e]),onChange:t=>{var l;K.setFieldValue("labels",{...null!==(l=K.values.labels)&&void 0!==l?l:{},[e]:t.target.value})},style:{flex:1}}),(0,p.jsx)(a.ActionIcon,{color:"red",variant:"light",onClick:()=>{var t;const l={...null!==(t=K.values.labels)&&void 0!==t?t:{}};delete l[e],K.setFieldValue("labels",l)},children:(0,p.jsx)(u.A,{size:16})})]},e)),(0,p.jsx)(a.Divider,{}),(0,p.jsxs)(a.Group,{align:"flex-end",children:[(0,p.jsx)(a.Select,{label:"Add label",data:le,value:Z,onChange:Y,placeholder:"Select key",style:{flex:1}}),(0,p.jsx)(a.TextInput,{label:"Text",value:ee,onChange:e=>te(e.target.value),placeholder:m.F.get(s.WG[Z]),style:{flex:2}}),(0,p.jsx)(a.Button,{leftSection:(0,p.jsx)(d.A,{size:16}),onClick:()=>{var e;Z&&(K.setFieldValue("labels",{...null!==(e=K.values.labels)&&void 0!==e?e:{},[Z]:ee}),Y(null),te(""))},children:"Add"})]})]})}),(0,p.jsx)(a.Card,{withBorder:!0,shadow:"sm",children:(0,p.jsxs)(a.Stack,{gap:"md",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(a.Title,{order:4,children:"Theme"}),(0,p.jsx)(a.Text,{size:"sm",c:"dimmed",children:"Customize Mantine theme settings used by the chatbot."})]}),(0,p.jsxs)(a.SimpleGrid,{cols:{base:1,sm:2},spacing:"md",verticalSpacing:"md",children:[(0,p.jsx)(a.Select,{label:(0,p.jsx)(S,{text:"Color mode",scrollToId:"chatbot-color-mode"}),description:'Theme mode. "auto" follows the site.',data:[{value:"auto",label:"Auto"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}],value:null!==(D=K.values.chatbot.colorMode)&&void 0!==D?D:"auto",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,colorMode:null!=e?e:"auto"})}),(0,p.jsx)(a.Select,{searchable:!0,clearable:!0,label:(0,p.jsx)(S,{text:"Primary color",scrollToId:"chatbot-primary-color"}),placeholder:"Select theme color",description:"Primary color used in the chatbot UI.",data:ne,value:null!==(W=K.values.chatbot?.primaryColor)&&void 0!==W?W:null,onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,...e?{primaryColor:e}:{primaryColor:void 0}})}),(0,p.jsxs)(a.Group,{grow:!0,align:"flex-start",children:[(0,p.jsx)(a.Select,{label:(0,p.jsx)(S,{text:"Primary shade (light)",scrollToId:"chatbot-primary-shade-light"}),data:ae,value:String(ce),description:"Shade used in light mode.",onChange:e=>{const t=Number.parseInt(null!=e?e:"6",10);K.setFieldValue("chatbot",{...K.values.chatbot,primaryShade:{light:Number.isFinite(t)?t:6,dark:de}})}}),(0,p.jsx)(a.Select,{label:(0,p.jsx)(S,{text:"Primary shade (dark)",scrollToId:"chatbot-primary-shade-dark"}),data:ae,value:String(de),description:"Shade used in dark mode.",onChange:e=>{const t=Number.parseInt(null!=e?e:"8",10);K.setFieldValue("chatbot",{...K.values.chatbot,primaryShade:{light:ce,dark:Number.isFinite(t)?t:8}})}})]})]}),(0,p.jsx)(a.Textarea,{label:(0,p.jsx)(S,{text:"Inline CSS",scrollToId:"chatbot-inner-css"}),description:"Optional CSS rules injected into the chatbot root.",placeholder:":host, #ai-kit-inline-root { --ai-kit-chat-border-radius: 16px; }",minRows:4,value:null!==(R=K.values.chatbot?.innerCSS)&&void 0!==R?R:"",resize:"vertical",onChange:e=>K.setFieldValue("chatbot",{...K.values.chatbot,innerCSS:e.currentTarget.value})}),(0,p.jsx)(a.Divider,{}),(0,p.jsxs)("div",{children:[(0,p.jsx)(a.Title,{order:5,children:(0,p.jsx)(S,{text:"Custom colors",scrollToId:"chatbot-custom-colors"})}),(0,p.jsx)(a.Text,{size:"sm",c:"dimmed",children:"Add named colors (hex) that can also be selected as the primary color."})]}),0===se.length&&(0,p.jsx)(a.Text,{size:"sm",c:"dimmed",children:"No custom colors yet."}),se.map(([e,t])=>(0,p.jsxs)(a.Group,{align:"flex-end",children:[(0,p.jsx)(a.TextInput,{label:"Name",defaultValue:e,onBlur:t=>{const l=t.currentTarget.value.trim();if(!l||l===e)return;if(l in oe)return void(t.currentTarget.value=e);const a={...oe},o=a[e];delete a[e],a[l]=o,K.setFieldValue("chatbot",{...K.values.chatbot,colors:Object.keys(a).length?a:void 0})},style:{flex:1}}),(0,p.jsx)(a.ColorInput,{label:"Hex",format:"hex",value:t,onChange:t=>{K.setFieldValue("chatbot",{...K.values.chatbot,colors:{...oe,[e]:t}})},style:{flex:1}}),(0,p.jsx)(a.ActionIcon,{color:"red",variant:"light",onClick:()=>{const t={...oe};delete t[e],K.setFieldValue("chatbot",{...K.values.chatbot,colors:Object.keys(t).length?t:void 0})},children:(0,p.jsx)(u.A,{size:16})})]},e)),(0,p.jsx)(a.Divider,{}),(0,p.jsxs)(a.Group,{align:"flex-end",children:[(0,p.jsx)(a.TextInput,{label:"New color name",placeholder:"e.g. brand",value:ue,description:"Unique name for the color.",onChange:e=>he(e.currentTarget.value),style:{flex:1}}),(0,p.jsx)(a.ColorInput,{label:"Hex",format:"hex",value:be,description:"Color value in hex format.",onChange:ve,style:{flex:1}}),(0,p.jsx)(a.Button,{leftSection:(0,p.jsx)(d.A,{size:16}),onClick:()=>{const e=ue.trim();e&&(e in oe||(K.setFieldValue("chatbot",{...K.values.chatbot,colors:{...oe,[e]:be}}),he("")))},children:"Add"})]})]})}),(0,p.jsx)(a.Group,{justify:"flex-end",children:(0,p.jsx)(a.Button,{loading:$,variant:"gradient",type:"submit",leftSection:(0,p.jsx)(i.A,{}),children:"Save Chatbot Settings"})})]})}),(0,p.jsx)("div",{style:{zIndex:1e5},children:(0,p.jsx)(s._Z,{...q,store:C,previewMode:!0,onClose:()=>{}})})]})}}}]);