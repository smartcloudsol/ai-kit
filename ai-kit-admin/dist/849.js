"use strict";(globalThis.webpackChunk_smart_cloud_ai_kit_admin=globalThis.webpackChunk_smart_cloud_ai_kit_admin||[]).push([[849],{6849(e,a,s){s.r(a),s.d(a,{default:()=>f});var n=s(8790),t=s(7641),l=s(899),o=s(7693),i=s(6705),c=s(7723),d=s(988),r=s(1609),b=s(8354),k=s(4200),m=s(9069),p=s(3514),u=s(3226),h=s(790);const g=b.Ikc({mode:b.k5n(["local-only","backend-fallback","backend-only"]).default("local-only"),backendTransport:b.k5n(["gatey","fetch"]).optional(),backendApiName:b.YjP().optional(),backendBaseUrl:b.YjP().optional()}).superRefine((e,a)=>{"local-only"!==e.mode&&(e.backendTransport?("gatey"!==e.backendTransport||e.backendApiName||a.addIssue({code:b.eqx.custom,path:["backendApiName"],message:"Required"}),"fetch"!==e.backendTransport||e.backendBaseUrl||a.addIssue({code:b.eqx.custom,path:["backendBaseUrl"],message:"Required"})):a.addIssue({code:b.eqx.custom,path:["backendTransport"],message:"Required"}))});function f({apiUrl:e,config:a,accountId:s,siteId:b,siteKey:f,onSave:x,InfoLabelComponent:y}){const[A,T]=(0,r.useState)(!1),j=(0,r.useMemo)(()=>(0,m.gF)(),[]),I=(0,r.useMemo)(()=>{try{const e=j?.cognito?.getAmplifyConfig?.()?.API?.REST??{};return Object.keys(e)}catch{return[]}},[j]),v=(0,n.useForm)({initialValues:{mode:a?.mode??"local-only",backendTransport:a?.backendTransport,backendApiName:a?.backendApiName,backendBaseUrl:a?.backendBaseUrl},validate:(0,d.s)(g)});(0,r.useEffect)(()=>{a&&v.setValues({mode:a.mode??"local-only",backendTransport:a.backendTransport,backendApiName:a.backendApiName,backendBaseUrl:a.backendBaseUrl})},[a]);const S=(0,r.useCallback)(e=>{const a=e??void 0;v.setFieldValue("backendTransport",a),"gatey"===a&&v.setFieldValue("backendBaseUrl",""),"fetch"===a&&v.setFieldValue("backendApiName","")},[v]),w=(0,r.useCallback)(async l=>{if(s&&b&&f){T(!0);try{const t={...{...a,mode:l.mode,backendTransport:"local-only"===l.mode?void 0:l.backendTransport,backendApiName:"local-only"===l.mode||"gatey"!==l.backendTransport?void 0:l.backendApiName,backendBaseUrl:"local-only"===l.mode||"fetch"!==l.backendTransport?void 0:l.backendBaseUrl}};delete t.subscriptionType;const o=await(0,p.D)(e,s,b,f,t);x(o),n.notifications.show({title:(0,c.__)("Settings saved",k.Xg),message:(0,c.__)("API settings saved successfully.",k.Xg),color:"green",icon:(0,h.jsx)(i.A,{}),className:u.A.notification})}catch(e){console.error("Error saving API settings:",e),n.notifications.show({title:(0,c.__)("Error occured",k.Xg),message:e.message,color:"red",icon:(0,h.jsx)(t.A,{}),className:u.A.notification})}finally{T(!1)}}else console.error("Missing account ID or site ID or site key")},[s,b,f,a,e,x]),N=v.values.backendTransport,P="local-only"!==v.values.mode;return(0,h.jsx)("form",{name:"apisettings-editor",onSubmit:v.onSubmit(w),style:{maxWidth:900},children:(0,h.jsxs)(n.Stack,{gap:"md",children:[(0,h.jsx)(n.Card,{withBorder:!0,shadow:"sm",children:(0,h.jsxs)(n.Stack,{gap:"md",children:[(0,h.jsx)(n.Group,{align:"flex-start",justify:"space-between",children:(0,h.jsxs)("div",{children:[(0,h.jsx)(n.Title,{order:4,children:"AI-Kit API configuration"}),(0,h.jsx)(n.Text,{size:"sm",c:"dimmed",children:"Configure how AI-Kit should reach backend endpoints when needed."})]})}),(0,h.jsxs)(n.Group,{grow:!0,align:"flex-start",children:[(0,h.jsx)(n.Select,{classNames:{label:u.A["form-field-label"]},label:(0,h.jsx)(y,{text:"Mode",scrollToId:"aikit-api-mode"}),withAsterisk:!0,data:[{value:"local-only",label:"On-device only"},{value:"backend-fallback",label:"On-device + backend fallback"},{value:"backend-only",label:"Backend only"}],...v.getInputProps("mode")},v.key("mode")),(0,h.jsx)(n.Select,{classNames:{label:u.A["form-field-label"]},label:(0,h.jsx)(y,{text:"Backend connection",scrollToId:"aikit-api-backend-transport"}),withAsterisk:P,disabled:!P,data:[{value:"gatey",label:"Amplify REST (via WP Suite)"},{value:"fetch",label:"Direct base URL"}],value:N??null,onChange:S,error:v.errors.backendTransport})]}),P&&"gatey"===N&&(0,h.jsxs)(n.Stack,{gap:6,children:[(0,h.jsx)(n.Select,{classNames:{label:u.A["form-field-label"]},label:(0,h.jsx)(y,{text:"REST API name",scrollToId:"aikit-api-backend-api-name"}),withAsterisk:!0,data:I,placeholder:I.length?"Select a REST API":"No REST APIs detected",disabled:!I.length,...v.getInputProps("backendApiName")},v.key("backendApiName")),(0,h.jsxs)(n.Text,{size:"xs",c:"dimmed",children:["Uses the REST API list from your Amplify configuration (",(0,h.jsx)("code",{children:"getAmplifyConfig().API.REST"}),")."]})]}),P&&"fetch"===N&&(0,h.jsxs)(n.Stack,{gap:6,children:[(0,h.jsx)(n.TextInput,{classNames:{label:u.A["form-field-label"]},label:(0,h.jsx)(y,{text:"Backend base URL",scrollToId:"aikit-api-backend-base-url"}),withAsterisk:!0,placeholder:"https://api.example.com",...v.getInputProps("backendBaseUrl")},v.key("backendBaseUrl")),(0,h.jsx)(n.Text,{size:"xs",c:"dimmed",children:"Enter the base URL of your AI-Kit backend (for example an API Gateway endpoint)."})]}),!P&&(0,h.jsxs)(n.Group,{gap:"xs",align:"center",children:[(0,h.jsx)(o.A,{size:16}),(0,h.jsxs)(n.Text,{size:"sm",c:"dimmed",children:["Backend is disabled in ",(0,h.jsx)("strong",{children:"On-device only"})," mode."]})]})]})}),(0,h.jsx)(n.Group,{justify:"flex-end",children:(0,h.jsx)(n.Button,{type:"submit",variant:"gradient",loading:A,leftSection:(0,h.jsx)(l.A,{size:16}),children:"Save API settings"})})]})})}},3514(e,a,s){async function n(e,a,s,n,t){const l=await fetch(`${e}/account/${a}/site/${s}/settings`,{method:"PUT",headers:{"Content-Type":"application/json","X-Site-Key":n,"X-Plugin":"ai-kit"},body:JSON.stringify({settings:t})});if(!l.ok){const e=await l.text();throw new Error(e||`HTTP error! status: ${l.status}`)}return(await l.json()).settings}s.d(a,{D:()=>n})}}]);